<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/improperClaimsNoticeOptions">
      <Name>Improper claims notice options</Name>
      <Description>Options for how long a TP has been restricted for taking CTC, ACTC, or ODC</Description>
      <Derived>
        <EnumOptions>
          <String>twoYears</String>
          <String>tenYears</String>
          <String>zeroYears</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/maybeEligibleForCtc">
      <Name>Whether the TP may be eligible to receive CTC based on dependents</Name>
      <Description>Whether there are dependents who are eligible for the Child Tax Credit.</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Count>
              <Dependency module="familyAndHousehold" path="/familyAndHousehold/*/eligibleCtc" />
            </Count>
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/flowAskAboutOdc">
      <Name>Whether we should ask the taxpayer about ODC eligibility</Name>
      <Description>This requires that we have ODC eligible individuals, and that we haven't asked
        about CTC. The
        questions about eligibility are the same as CTC, so we don't ask them twice -- we just
        default to CTC.</Description>

      <Derived>
        <All>
          <Dependency path="/maybeEligibleForOdc" />
          <Not>
            <Dependency path="/maybeEligibleForCtc" />
          </Not>
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForOdc">
      <Name>Whether the TP may be eligible for ODC based on dependents</Name>
      <Description>Whether there are dependents who are eligible for the Credit for Other
        Dependents.</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/odcEligibleDependents" />
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/ctcEligibleDependents">
      <Name>Number of CTC-eligible dependents</Name>
      <Description>The number of dependents who are eligible for the Child Tax Credit. Reported on
        line 4 of Schedule
        8812.</Description>
      <Export mef="true" />

      <Derived>
        <Count>
          <Dependency module="familyAndHousehold" path="/familyAndHousehold/*/eligibleCtc" />
        </Count>
      </Derived>
    </Fact>

    <Fact path="/pdf8812ContinueFromLine16a">
      <Name>Continue Schedule 8812 from Line 16a</Name>
      <Description>Whether to continue in sequence from Line 16a.</Description>
      <Derived>
        <NotEqual>
          <Left>
            <Dependency path="/remainingCtcAndOdc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </NotEqual>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line16bCount">
      <Name>Display value for PDF Schedule 8812, Line 16b (count)</Name>
      <Description>The number of dependents who are eligible for the Child Tax Credit if completing
        Part II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16a" />
            </When>
            <Then>
              <Dependency path="/ctcEligibleDependents" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/totalPotentialCtc">
      <Name>Total potential CTC</Name>
      <Description>The maximum amount of the Child Tax Credit that could be claimed. Reported on
        line 5 of Schedule
        8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <Any>
                  <Dependency path="/ctcOdcDisqualifiedForImproperClaims" />
                  <Not>
                    <Dependency path="/maybeEligibleForCtc" />
                  </Not>
                </Any>
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Multiply>
                  <Dependency path="/ctcEligibleDependents" />
                  <Dependency path="/maxCtcAmount" />
                </Multiply>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line16bAmount">
      <Name>Display value for PDF Schedule 8812, Line 16b (amount)</Name>
      <Description>The maximum amount of the Child Tax Credit that could be claimed if completing
        Part II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16a" />
            </When>
            <Then>
              <Dependency path="/totalPotentialActc" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/pdf8812ContinueFromLine16b">
      <Name>Continue Schedule 8812 from Line 16b</Name>
      <Description>Whether to continue in sequence from Line 16b.</Description>
      <Derived>
        <NotEqual>
          <Left>
            <Dependency path="/pdf8812Line16bAmount" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </NotEqual>
      </Derived>
    </Fact>

    <Fact path="/maxCtcAmount">
      <Name>Maximum child tax credit amount</Name>
      <Description>The maximum child tax credit per child</Description>
      <TaxYear>2025</TaxYear>

      <Derived>
        <Dollar>2000</Dollar>
      </Derived>
    </Fact>

    <Fact path="/odcEligibleDependents">
      <Name>Number of ODC-eligible dependents</Name>
      <Description>The number of dependents who are eligible for the Credit for Other Dependents.
        Reported on line 6 of
        Schedule 8812.</Description>
      <Export mef="true" />

      <Derived>
        <Count>
          <Dependency module="familyAndHousehold" path="/familyAndHousehold/*/eligibleOdc" />
        </Count>
      </Derived>
    </Fact>

    <Fact path="/exactlyOneOdcEligibleDependent">
      <Name>Exactly one ODC-eligible dependent</Name>
      <Description>Whether the taxpayer has exactly one ODC-eligible dependent.</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/odcEligibleDependents" />
          </Left>
          <Right>
            <Int>1</Int>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/moreThanOneOdcEligibleDependent">
      <Name>More than one ODC-eligible dependent</Name>
      <Description>Whether the taxpayer has more than one ODC-eligible dependent.</Description>

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/odcEligibleDependents" />
          </Left>
          <Right>
            <Int>1</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/totalPotentialOdc">
      <Name>Total potential ODC</Name>
      <Description>The maximum amount of the Credit for Other Dependents that could be claimed.
        Reported on line 7 of
        Schedule 8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <Any>
                  <Dependency path="/ctcOdcDisqualifiedForImproperClaims" />
                  <Not>
                    <Dependency path="/maybeEligibleForOdc" />
                  </Not>
                </Any>
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Multiply>
                  <Dependency path="/odcEligibleDependents" />
                  <Dependency path="/maxOdcAmount" />
                </Multiply>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/maxOdcAmount">
      <Name>Maximum credit amount for other dependents</Name>
      <Description>The maximum credit for other dependents, per dependent</Description>
      <TaxYear>2025</TaxYear>

      <Derived>
        <Dollar>500</Dollar>
      </Derived>
    </Fact>

    <Fact path="/totalPotentialDependentCredits">
      <Name>Total potential dependent credits</Name>
      <Description>The combined amount of the maximum Child Tax Credit and Credit for Other
        Dependents. Reported on line
        8 of Schedule 8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency path="/totalPotentialCtc" />
            <Dependency path="/totalPotentialOdc" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditPhaseoutThreshold">
      <Name>Dependent credit phaseout threshold</Name>
      <Description>The MAGI threshold at which the dependent credits begin to phaseout. Reported on
        line 9 of Schedule
        8812.</Description>
      <Export mef="true" />
      <TaxYear>2024</TaxYear>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Dollar>400000</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <Not>
                <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
              </Not>
            </When>
            <Then>
              <Dollar>200000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditMagiAboveThreshold">
      <Name>Dependent credit MAGI above threshold</Name>
      <Description>The amount of excess income above the threshold.</Description>

      <Derived>
        <GreaterOf>
          <Subtract>
            <Minuend>
              <Dependency path="/dependentCreditMagi" />
            </Minuend>
            <Subtrahends>
              <Dependency path="/dependentCreditPhaseoutThreshold" />
            </Subtrahends>
          </Subtract>
          <Dollar>0</Dollar>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/roundedDependentCreditMagiAboveThreshold">
      <Name>Rounded dependent credit MAGI above threshold</Name>
      <Description>In whole $1,000s, the amount of excess income above the threshold. Per §24(b)(2),
        any fraction of
        $1,000 is rounded to $1,000. Reported on line 10 of Form 8812.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <StepwiseMultiply>
            <Multiplicand>
              <Add>
                <Dependency path="/dependentCreditMagiAboveThreshold" />
                <Dollar>999.99</Dollar> <!-- round up to the nearest $1,000 -->
              </Add>
            </Multiplicand>
            <Rate>
              <Rational>1000/1000</Rational>
            </Rate>
          </StepwiseMultiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditPhaseout">
      <Name>Dependent credit phaseout</Name>
      <Description>The amount to reduce the dependent credit amount by. Reported on line 11 of Form
        8812.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/roundedDependentCreditMagiAboveThreshold" />
            <Rational>5/100</Rational>
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditLessPhaseout">
      <Name>Dependent credit less phaseout</Name>
      <Description>The amount of dependent credits left to claim after applying the phaseout.
        Reported on line 12 of
        Form
        8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/totalPotentialDependentCredits" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/dependentCreditPhaseout" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditNotFullyPhasedOut">
      <Name>Dependent credit not fully phased out</Name>
      <Description>Whether there is any amount of dependent credits left to claim after applying the
        phaseout. Reported
        on a checkbox on line 12 of Form 8812.</Description>
      <Export mef="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/dependentCreditLessPhaseout" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditFullyPhasedOut">
      <Name>Dependent credit fully phased out</Name>
      <Description>Whether there is no amount of dependent credits left to claim after applying the
        phaseout. Reported
        on
        a checkbox on line 12 of Form 8812.</Description>

      <Derived>
        <Not>
          <Dependency path="/dependentCreditNotFullyPhasedOut" />
        </Not>
      </Derived>
    </Fact>

    <Fact path="/maxPotentialOdcAfterPhaseOut">
      <Name>Max potential ODC amount after phase out</Name>
      <Description>The max potential odc amount accounting for phase out if applicable</Description>

      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency path="/totalPotentialOdc" />
            </Minuend>
            <Subtrahends>
              <Dependency path="/dependentCreditPhaseout" />
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/xmlHasRemainingCtcAndOdc">
      <Name>Has remaining CTC and ODC</Name>
      <Description>Whether there is any CTC or ODC remaining to be processed, meaning that the
        dependent credit
        hasn't
        phased out and there is still some CTC or ODC. Encountered on line 16a of form 8812.
        Determines if lines 16b -
        26
        may be applicable.</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency path="/dependentCreditNotFullyPhasedOut" />
          <GreaterThan>
            <Left>
              <Dependency path="/remainingCtcAndOdc" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/xmlHasPotentialActc">
      <Name>Has potential ACTC</Name>
      <Description>Whether there is any CTC or ODC that can be processed and there is some potential
        ACTC
        representing
        Encountered on line 16b of form 8812. Determines if lines 17-26 may be applicable</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency path="/xmlHasRemainingCtcAndOdc" />
          <GreaterThan>
            <Left>
              <Dependency path="/totalPotentialActc" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/xmlThreeOrMoreCtcEligibleDependents">
      <Name>Three of more CTC eligible CTC dependents</Name>
      <Description>Whether we have 3 CTC eligible dependents and potential ACTC. Encountered on line
        20 of Schedule
        8812.
        Determines if lines 21-26 are applicable. TODO in future tax years: take Puerto Rico
        residency into
        account
      </Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency path="/xmlHasPotentialActc" />
          <Dependency path="/threeOrMoreCtcEligibleDependents" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/totalCtc">
      <Name>Total CTC from the CTC/ODC</Name>
      <Description>Total amount of CTC the TP will receive after the phaseout. It is derived and used for us to help the
        taxpayer make sense of how much of their credit comes from ctc, but it does not exist directly on schedule 8812.
        CTC credits are applied after ODC credits as per the IRM and when there is a phase out are reduced after ODC
        credits.</Description>

      <Derived>
        <Switch>
          <!-- Switch statement is necessary to avoid divide by zero when total is zero -->
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/totalCtcAndOdc" />
                </Left>
                <Right>
                  <Dollar>0</Dollar>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Subtract>
                <Minuend>
                  <Dependency path="/totalCtcAndOdc" />
                </Minuend>
                <Subtrahends>
                  <Dependency path="/totalOdc" />
                </Subtrahends>
              </Subtract>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isReceivingCtc">
      <Name>Is receiving CTC</Name>
      <Description>Whether the TP is receiving the child tax credit</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/totalCtc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/totalOdc">
      <Name>Total ODC from the CTC/ODC</Name>
      <Description>Total amount of ODC the TP will receive after the phaseout. It is derived and used for us to help the
        taxpayer make sense of how much of their credit comes from odc, but it does not exist directly on schedule 8812.
        ODC credits are applied before CTC credits as per the IRM and is also reduced first if there is a phase out.</Description>

      <Derived>
        <Switch>
          <!-- Switch statement is necessary to avoid divide by zero when total is zero -->
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/totalCtcAndOdc" />
                </Left>
                <Right>
                  <Dollar>0</Dollar>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <LesserOf>
                <Dependency path="/maxPotentialOdcAfterPhaseOut" />
                <Dependency path="/totalCtcAndOdc" />
              </LesserOf>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isReceivingOdc">
      <Name>Is receiving ODC </Name>
      <Description>Whether the TP is receiving the credit for other dependents</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/totalOdc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/isReceivingCtcOrOdc">
      <Name>Is receiving CTC or ODC</Name>
      <Description>Whether the TP is receiving the child tax credit or credit for other dependents</Description>
      <Export mef="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/totalCtcAndOdc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/sched8812CreditLimit">
      <Name>Credit Limit for Credits for Qualifying Children and Other Depednents</Name>
      <Description>The credit limit per Credit Limit Worksheet A from Schedule 8812. Reported on line 13.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency module="taxCalculations" path="/totalTentativeTax" />
            </Minuend>
            <Subtrahends>
              <Dependency module="schedule3" path="/sched3Line1" /> <!-- PLACEHOLDER -->
              <Dependency module="cdcc" path="/cdccTotalCredit" />
              <Dependency module="schedule3" path="/sched3Line3" /> <!-- PLACEHOLDER -->
              <Dependency module="saversCredits" path="/qualifiedSaverCreditAmount" />
              <Dependency module="schedule3" path="/sched3Line5b" /> <!-- PLACEHOLDER -->
              <Dependency module="elderlyAndDisabled" path="/totalEdc" />
              <Dependency module="schedule3" path="/sched3Line6f" /> <!-- PLACEHOLDER -->
              <Dependency module="schedule3" path="/sched3Line6l" /> <!-- PLACEHOLDER -->
              <Dependency module="schedule3" path="/sched3Line6m" /> <!-- PLACEHOLDER -->
              <!-- OUT OF SCOPE: AMOUNT FROM CREDIT LIMIT WORKSHEET B -->
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>

    <Fact path="/totalCtcAndOdc">
      <Name>Total CTC and ODC</Name>
      <Description>The total amount of the child tax credit and credit for other dependents.
        Reported on line 14 of Form
        8812 (although for ExportZero reasons, there is a separate fact below), and line 19 of Form
        1040.</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <Round>
          <LesserOf>
            <Dependency path="/dependentCreditLessPhaseout" />
            <Dependency path="/sched8812CreditLimit" />
          </LesserOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/xmlTotalCtcAndOdcFor8812">
      <Name>Total CTC and ODC</Name>
      <Description>The total amount of the child tax credit and credit for other dependents.
        Reported on line 14 of Form
        8812.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Dependency path="/totalCtcAndOdc" />
      </Derived>
    </Fact>

    <Fact path="/remainingCtcAndOdc">
      <Name>Remaining CTC and ODC</Name>
      <Description>The amount of dependent credits left to claim after crediting the total tentative
        tax. Reported on
        line 16a of Form 8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/dependentCreditLessPhaseout" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/totalCtcAndOdc" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/totalPotentialActc">
      <Name>Total potential additional CTC</Name>
      <Description>The maximum amount of the Additional Child Tax Credit that could be claimed.
        Reported on line 16b of
        Schedule 8812.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <Any>
                  <Dependency path="/ctcOdcDisqualifiedForImproperClaims" />
                  <Not>
                    <Dependency path="/maybeEligibleForCtc" />
                  </Not>
                </Any>
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Multiply>
                  <Dependency path="/ctcEligibleDependents" />
                  <Dependency path="/maxActcAmount" />
                </Multiply>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/maxActcAmount">
      <Name>Maximum additional child tax credit amount</Name>
      <Description>The maximum additional tax credit per child
        Rev Proc .05 Child Tax Credit §24(d)(1)(A)
      </Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Dollar>1700</Dollar>
      </Derived>
    </Fact>

    <Fact path="/remainingPotentialActc">
      <Name>Remaining potential additional CTC</Name>
      <Description>The remaining amount of the Additional Child Tax Credit that could be claimed
        after crediting the
        total tentative tax.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <LesserOf>
            <Dependency path="/remainingCtcAndOdc" />
            <Dependency path="/totalPotentialActc" />
          </LesserOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line17">
      <Name>Display value for PDF Schedule 8812, Line 17</Name>
      <Description>The remaining amount of the Additional Child Tax Credit that could be claimed if
        completing Part
        II-A;
        undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/remainingPotentialActc" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/actcRefundabilityThreshold">
      <Name>Additional CTC refundability threshold</Name>
      <Description>The amount of earned income that must be exceeded in order to receive the
        refundable additional child
        tax credit.</Description>
      <TaxYear>2024</TaxYear>

      <Derived>
        <Dollar>2500</Dollar>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomeAboveActcRefundabilityThreshold">
      <Name>Earned income above additional CTC refundability threshold</Name>
      <Description>The amount of earned income that can be used to calculate the refundable amount
        of the additional
        child tax credit.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency module="income" path="/earnedIncomeWithAllCombatPay" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/actcRefundabilityThreshold" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line19Amount">
      <Name>Display value for PDF Schedule 8812, Line 19 amount</Name>
      <Description>Earned income above additional CTC refundability threshold if completing Part
        II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/earnedIncomeAboveActcRefundabilityThreshold" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomeExceedsActcRefundabilityThreshold">
      <Name>Earned income exceeds additional CTC refundability threshold</Name>
      <Description>Whether the taxpayer has enough earned income to qualify for the additional Child
        Tax Credit.
        Addition
        12/22/23 - Also checking the real potential ACTC (compared against remaining CTC,
        ODC and potential
        ACTC)
        This
        represents the "Yes" checkbox on line 19 of the 8812 that determines if the line 19
        dollar amount
        field should
        have a value.
      </Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency path="/xmlHasPotentialActc" />
          <GreaterThan>
            <Left>
              <Dependency path="/earnedIncomeAboveActcRefundabilityThreshold" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line19Yes">
      <Name>Display value for PDF Schedule 8812, Line 19 Yes checkbox</Name>
      <Description>Whether earned income exceeds threshold if completing Part II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/earnedIncomeExceedsActcRefundabilityThreshold" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/earnedIncomeSubceedsActcRefundabilityThreshold">
      <Name>Earned income additional CTC refundability threshold</Name>
      <Description>Whether the taxpayer has too little earned income to qualify for the additional
        Child Tax Credit.
        Reported in a checkbox on line 19 of Form 8812.</Description>

      <Derived>
        <Not>
          <Dependency path="/earnedIncomeExceedsActcRefundabilityThreshold" />
        </Not>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line19No">
      <Name>Display value for PDF Schedule 8812, Line 19 No checkbox</Name>
      <Description>Whether earned income subceeds threshold if completing Part II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/earnedIncomeSubceedsActcRefundabilityThreshold" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/regularMaximumActc">
      <Name>Regular maximum additional child tax credit</Name>
      <Description>The maximum amount of the additional child tax credit that could be refunded to
        you, absent
        provisions
        for taxpayers with three or more children.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/earnedIncomeAboveActcRefundabilityThreshold" />
            <Rational>15/100</Rational>
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line20">
      <Name>Display value for PDF Schedule 8812, Line 20</Name>
      <Description>Regular maximum ACTC if completing Part II-A; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/regularMaximumActc" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/threeOrMoreCtcEligibleDependents">
      <Name>Three or more CTC-eligible dependents</Name>
      <Description>Whether the taxpayer has three or more CTC-eligible dependents.</Description>
      <Export mef="true" />

      <Derived>
        <GreaterThanOrEqual>
          <Left>
            <Dependency path="/ctcEligibleDependents" />
          </Left>
          <Right>
            <Int>3</Int>
          </Right>
        </GreaterThanOrEqual>
      </Derived>
    </Fact>

    <Fact path="/exactlyOneCtcEligibleDependent">
      <Name>Exactly one CTC-eligible dependent</Name>
      <Description>Whether the taxpayer has exactly one CTC-eligible dependent.</Description>

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/ctcEligibleDependents" />
          </Left>
          <Right>
            <Int>1</Int>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/moreThanOneCtcEligibleDependent">
      <Name>More than one CTC-eligible dependent</Name>
      <Description>Whether the taxpayer has more than one CTC-eligible dependent.</Description>

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/ctcEligibleDependents" />
          </Left>
          <Right>
            <Int>1</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>


    <Fact path="/pdf8812Line20Yes">
      <Name>Display value for PDF Schedule 8812, Line 20 Yes checkbox</Name>
      <Description>Whether the taxpayer has three or more CTC-eligible dependents if completing Part
        II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/threeOrMoreCtcEligibleDependents" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>


    <Fact path="/lessThanThreeCtcEligibleDependents">
      <Name>Less than three CTC-eligible dependents</Name>
      <Description>Whether the taxpayer has less than three CTC-eligible dependents. Entered in a
        checkbox on line 20 of
        Form 8812.</Description>

      <Derived>
        <Not>
          <Dependency path="/threeOrMoreCtcEligibleDependents" />
        </Not>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line20No">
      <Name>Display value for PDF Schedule 8812, Line 20 No checkbox</Name>
      <Description>Whether the taxpayer has less than three CTC-eligible dependents if completing
        Part II-A; undefined
        otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency path="/lessThanThreeCtcEligibleDependents" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/pdf8812ContinueFromLine20">
      <Name>Continue Schedule 8812 from Line 20</Name>
      <Description>Whether to continue in sequence from Line 20.</Description>
      <TaxYear>2024</TaxYear>
      <!-- Note there is logic for PR residents not reflected here as it is out of scope. -->
      <Derived>
        <Switch>
          <Case>
            <When>
              <Not>
                <GreaterThanOrEqual>
                  <Left>
                    <Dependency path="/pdf8812Line16bAmount" />
                  </Left>
                  <Right>
                    <Multiply>
                      <Int>3</Int>
                      <Dependency path="/maxActcAmount" />
                    </Multiply>
                  </Right>
                </GreaterThanOrEqual>
              </Not>
            </When>
            <Then>
              <False />
            </Then>
          </Case>
          <Case>
            <When>
              <GreaterThanOrEqual>
                <Left>
                  <Dependency path="/pdf8812Line20" />
                </Left>
                <Right>
                  <Dependency path="/pdf8812Line17" />
                </Right>
              </GreaterThanOrEqual>
            </When>
            <Then>
              <False />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <True />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/socialSecurityOverEitc">
      <Name>Social Security taxes in excess of EITC claimed</Name>
      <Description>Social Security taxes in excess of EITC claimed.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency module="formW2s" path="/socialSecurityTaxesWithheld" />
              </Minuend>
              <Subtrahends>
                <Dependency module="eitc" path="/earnedIncomeCredit" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line25">
      <Name>Display value for PDF Schedule 8812, Line 25</Name>
      <Description>Social Security taxes in excess of EITC claimed if completing Part II-B;
        undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine20" />
            </When>
            <Then>
              <Dependency path="/socialSecurityOverEitc" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/maximumActc">
      <Name>Maximum additional child tax credit</Name>
      <Description>The maximum amount of the additional child tax credit that could be refunded to
        you.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <Dependency path="/threeOrMoreCtcEligibleDependents" />
              </When>
              <Then>
                <GreaterOf>
                  <Dependency path="/regularMaximumActc" />
                  <Dependency path="/socialSecurityOverEitc" />
                </GreaterOf>
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Dependency path="/regularMaximumActc" />
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line26">
      <Name>Display value for PDF Schedule 8812, Line 26</Name>
      <Description>Maximum additional child tax credit if completing Part II-B; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine20" />
            </When>
            <Then>
              <Dependency path="/maximumActc" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/additionalCtc">
      <Name>Additional child tax credit</Name>
      <Description>The refundable amount of the additional child tax credit. Entered on line 27 of
        Form 8812 and line 28
        of Form 1040.</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <Round>
          <LesserOf>
            <Dependency path="/remainingPotentialActc" />
            <Dependency path="/maximumActc" />
          </LesserOf>
        </Round>
      </Derived>
    </Fact>


    <Fact path="/isReceivingActc">
      <Name>Is receiving actc</Name>
      <Description>Whether the TP is receiving ACTC</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/additionalCtc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>


    <Fact path="/ctcOdcDisqualifiedForImproperClaims">
      <Name>CTC Disqualified for Improper Claims</Name>
      <Description>Whether the TP has been diqualified from taking the CTC due to previous improper
        claims</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Dependency path="/receivedImproperClaims" />
          <Not>
            <Dependency path="/hasFiledCtcOdcSinceNoticeExpired" />
          </Not>
          <Dependency path="/hadCtcOdcImproperClaimsBan" />
          <Not>
            <Dependency path="/improperClaimsNoticeExpired" />
          </Not>
        </All>
      </Derived>
    </Fact>

    <Fact path="/ctcQualified">
      <Name>Receiving CTC</Name>
      <Description>Whether the TP can receive the CTC, prior to MAGI adjustments</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Not>
            <Dependency path="/ctcOdcDisqualifiedForImproperClaims" />
          </Not>
          <Dependency path="/maybeEligibleForCtc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/odcQualified">
      <Name>Receiving ODC</Name>
      <Description>Whether the TP can receive the ODC, prior to MAGI adjustments</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Not>
            <Dependency path="/ctcOdcDisqualifiedForImproperClaims" />
          </Not>
          <Dependency path="/maybeEligibleForOdc" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/ctc8862Required">
      <Name>ctc8862Required</Name>
      <Description>Used to indicate whether Part III of Schedule 8862 is applicable</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <All>
          <Any>
            <Dependency path="/isReceivingCtc" />
            <Dependency path="/isReceivingActc" />
            <Dependency path="/isReceivingOdc" />
          </Any>
          <Dependency path="/receivedImproperClaims" />
          <Not>
            <Dependency path="/hasFiledCtcOdcSinceNoticeExpired" />
          </Not>
          <Any>
            <All>
              <Dependency path="/hadCtcOdcImproperClaimsBan" />
              <Dependency path="/improperClaimsNoticeExpired" />
            </All>
            <Equal>
              <Left>
                <Dependency path="/receivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">zeroYears</Enum>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/receivedImproperClaims">
      <Name>Received CTC improper claims</Name>
      <Description>Since 2015 (TY -8?) the IRS has reduced or disallowed the TP or MFJ spouse's CTC,
        ACTC, or ODC for
        reasons other than a math error.</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/receivedImproperClaimsNotice">
      <Name>Received CTC improper Claims notice</Name>
      <Description>Whether the TP received a letter from the IRS telling them they're not allowed to
        take CTC, ACTC, or
        ODC for a number of years</Description>
      <Writable>
        <Enum optionsPath="/improperClaimsNoticeOptions" />
      </Writable>
    </Fact>

    <Fact path="/improperClaimsNoticeExpired">
      <Name>CTC improper claims notice expired</Name>
      <Description>Whether the improper claims notice that the TP previously received is far enough
        in the past to be
        expired. E.g. They could not file for 2 years, and it has been at least 2 years</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/hasFiledCtcOdcSinceNoticeExpired">
      <Name>CTC Has Filed CTC or ODC since notice expired</Name>
      <Description>Whether the TP has filed for CTC or ODC again since the notice has expired. The
        first time a taxpayer
        files after their notice has expired, they need to fill out form 8862.</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/hadCtcOdcImproperClaimsBan">
      <Name>Flow CTC Ask Improper Claims Expiration</Name>
      <Description>Whether the flow should ask a person if their CTC improper claims notice has
        expired</Description>
      <Derived>
        <All>
          <Not>
            <Dependency path="/hasFiledCtcOdcSinceNoticeExpired" />
          </Not>
          <Any>
            <Equal>
              <Left>
                <Dependency path="/receivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">twoYears</Enum>
              </Right>
            </Equal>
            <Equal>
              <Left>
                <Dependency path="/receivedImproperClaimsNotice" />
              </Left>
              <Right>
                <Enum optionsPath="/improperClaimsNoticeOptions">tenYears</Enum>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/dependentCreditMagi">
      <Name>Modified AGI for purposes of dependent credits</Name>
      <Description>
        Modified AGI for purposes of dependent credits. Reported on line 3 of Schedule 8812.

        Schedule 8812
        line 2a is 0 because Puerto Rico is out of scope;
        Schedule 8812 line 2b is 0 because Foreign Earned
        Income (Form
        2555) is out of scope;
        Schedule 8812 line 2c is 0 because residents of American Samoa (Form 4563) are
        out of
        scope;
        Therefore the MAGI, due to scope, is the AGI
      </Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Dependency module="taxCalculations" path="/agi" />
        </Round>
      </Derived>
    </Fact>

    <Fact path="/pdfIncludeSchedule8812">
      <Name>Include Schedule 8812 in tax return PDF</Name>
      <Description>Whether the tax return PDF should include Schedule 8812.</Description>

      <Derived>
        <Any>
          <GreaterThan>
            <Left>
              <Dependency path="/totalCtcAndOdc"></Dependency>
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
          <GreaterThan>
            <Left>
              <Dependency path="/additionalCtc"></Dependency>
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line18a">
      <Name>Display value for PDF Schedule 8812, Line 18a</Name>
      <Description>Earned income with all combat pay if completing Part II-A; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency module="income" path="/earnedIncomeWithAllCombatPay" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line18b">
      <Name>Display value for PDF Schedule 8812, Line 18b</Name>
      <Description>Nontaxable combat pay if completing Part II-A; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine16b" />
            </When>
            <Then>
              <Dependency module="formW2s" path="/allCombatPay" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line21">
      <Name>Display value for PDF Schedule 8812, Line 21</Name>
      <Description>Social Security taxes withheld if completing Part II-B; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine20" />
            </When>
            <Then>
              <Dependency module="formW2s" path="/socialSecurityTaxesWithheld" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/pdf8812Line24">
      <Name>Display value for PDF Schedule 8812, Line 24</Name>
      <Description>Earned income credit if completing Part II-B; undefined otherwise.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/pdf8812ContinueFromLine20" />
            </When>
            <Then>
              <Dependency module="eitc" path="/earnedIncomeCredit" />
            </Then>
          </Case>
          <!-- otherwise: undefined -->
        </Switch>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
